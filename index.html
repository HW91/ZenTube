<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Video Filter</title>
</head>
<body>
  <h1>YouTube Video Filter</h1>

  <label>Search Term: <input type="text" id="searchTerm"></label><br>

  <label>
    <input type="checkbox" id="toggleBlockTerms" checked onchange="toggleBlockTermsBox()"> Show Blocked Terms Box
  </label><br>

  <div id="blockTermsBox">
    <label>Blocked Terms (comma-separated): <input type="text" id="blockTerms"></label><br>
  </div>

  <label>Max Results (1â€“50): <input type="number" id="maxResults" value="10" min="1" max="50"></label><br>
  <label>Show Shorts: <input type="checkbox" id="showShorts" checked></label><br>
  <label>Show Blocked Results: <input type="checkbox" id="showBlocked" checked></label><br>

  <label>Upload Date:
    <select id="uploadDate">
      <option value="">Any time</option>
      <option value="1">Last day</option>
      <option value="7">Last week</option>
      <option value="30">Last month</option>
      <option value="90">Last 3 months</option>
      <option value="365">Last year</option>
    </select>
  </label><br>

  <button onclick="fetchVideos()">Search</button>

  <div id="results"></div>

  <script>
    const API_KEY = 'AIzaSyCOpM3LTOwzxzi2rHyDeWx5GM-D3wV7CS4';
    const API_URL = 'https://www.googleapis.com/youtube/v3/search';

    function toggleBlockTermsBox() {
      const box = document.getElementById('blockTermsBox');
      const checkbox = document.getElementById('toggleBlockTerms');
      box.style.display = checkbox.checked ? 'block' : 'none';
    }

    function getPublishedAfter(daysAgo) {
      if (!daysAgo) return '';
      const date = new Date();
      date.setDate(date.getDate() - parseInt(daysAgo));
      return date.toISOString();
    }

    async function fetchVideos() {
      const searchTerm = document.getElementById('searchTerm').value.trim();
      const blockInput = document.getElementById('blockTerms').value.trim();
      const blockTerms = blockInput ? blockInput.toLowerCase().split(',').map(t => t.trim()) : [];
      const maxResults = parseInt(document.getElementById('maxResults').value) || 10;
      const showShorts = document.getElementById('showShorts').checked;
      const showBlocked = document.getElementById('showBlocked').checked;
      const uploadDays = document.getElementById('uploadDate').value;
      const publishedAfter = getPublishedAfter(uploadDays);

      if (!searchTerm) {
        alert('Please enter a search term.');
        return;
      }

      let url = `${API_URL}?key=${API_KEY}&part=snippet&type=video&q=${encodeURIComponent(searchTerm)}&maxResults=${maxResults}`;
      if (publishedAfter) {
        url += `&publishedAfter=${encodeURIComponent(publishedAfter)}`;
      }

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`API error: ${response.status}`);
        const data = await response.json();

        const filtered = data.items.filter(item => {
          const title = item.snippet.title.toLowerCase();
          const isBlocked = blockTerms.some(term => title.includes(term));
          const isShort = item.snippet.description?.includes('#shorts');
          const shouldHide = (isBlocked && !showBlocked) || (!showShorts && isShort);
          return !shouldHide;
        });

        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        filtered.forEach(item => {
          const videoId = item.id.videoId;
          const title = item.snippet.title;
          const url = `https://www.youtube.com/watch?v=${videoId}`;
          const div = document.createElement('div');
          div.innerHTML = `<p><a href="${url}" target="_blank">${title}</a></p>`;
          resultsDiv.appendChild(div);
        });

      } catch (err) {
        console.error(err);
        alert('Failed to fetch videos.');
      }
    }

    window.onload = toggleBlockTermsBox;
  </script>
</body>
</html>

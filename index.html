<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Video Filter</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 1rem;
      max-width: 800px;
      margin: auto;
    }
    label {
      display: block;
      margin: 0.5rem 0 0.2rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
    }
    .video {
      border-bottom: 1px solid #ccc;
      padding: 0.5rem 0;
    }
    .hide-blocked {
      display: none;
    }
    @media (max-width: 600px) {
      input, select, textarea {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <h1>YouTube Video Filter</h1>
  <label>Search Term:</label>
  <input type="text" id="searchTerm" /><label>Blocked Terms (comma-separated):</label>

  <textarea id="blockedTerms"></textarea><label><input type="checkbox" id="hideBlockedBoxToggle" /> Hide Blocked Terms Box</label>

  <div id="blockedTermsBox">
    <label>Blocked Terms (again):</label>
    <textarea id="blockedTermsVisible"></textarea>
  </div><label>Date Filter:</label> <select id="dateFilter"> <option value="">Any Time</option> <option value="day">Last Day</option> <option value="week">Last Week</option> <option value="month">Last Month</option> <option value="3months">Last 3 Months</option> <option value="year">Last Year</option> </select>

<label>Sort By:</label> <select id="sortBy"> <option value="relevance">Relevance</option> <option value="date">Date</option> <option value="viewCount">View Count</option> </select>

<label>Sort Order:</label> <select id="sortOrder"> <option value="desc">Descending</option> <option value="asc">Ascending</option> </select>

<label><input type="checkbox" id="hideShorts" /> Hide Shorts</label> <label><input type="checkbox" id="onlyEnglish" /> Only English Videos</label> <label><input type="checkbox" id="onlyUS" /> Only US Videos</label>

<button onclick="searchVideos()">Search</button>

  <div id="results"></div>  <script>
    const API_KEY = 'AIzaSyCOpM3LTOwzxzi2rHyDeWx5GM-D3wV7CS4';

    document.getElementById('hideBlockedBoxToggle').addEventListener('change', function() {
      document.getElementById('blockedTermsBox').style.display = this.checked ? 'none' : 'block';
    });

    function parseDuration(duration) {
      const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      const hours = parseInt(match?.[1]) || 0;
      const minutes = parseInt(match?.[2]) || 0;
      const seconds = parseInt(match?.[3]) || 0;
      return hours * 3600 + minutes * 60 + seconds;
    }

    async function searchVideos() {
      const query = document.getElementById('searchTerm').value;
      const blocked = document.getElementById('blockedTerms').value.toLowerCase().split(',').map(s => s.trim());
      const dateFilter = document.getElementById('dateFilter').value;
      const sortBy = document.getElementById('sortBy').value;
      const sortOrder = document.getElementById('sortOrder').value;
      const hideShorts = document.getElementById('hideShorts').checked;
      const onlyEnglish = document.getElementById('onlyEnglish').checked;
      const onlyUS = document.getElementById('onlyUS').checked;

      let publishedAfter = '';
      if (dateFilter) {
        const now = new Date();
        if (dateFilter === 'day') now.setDate(now.getDate() - 1);
        if (dateFilter === 'week') now.setDate(now.getDate() - 7);
        if (dateFilter === 'month') now.setMonth(now.getMonth() - 1);
        if (dateFilter === '3months') now.setMonth(now.getMonth() - 3);
        if (dateFilter === 'year') now.setFullYear(now.getFullYear() - 1);
        publishedAfter = now.toISOString();
      }

      let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=25&q=${encodeURIComponent(query)}&key=${API_KEY}&order=${sortBy}`;
      if (publishedAfter) url += `&publishedAfter=${publishedAfter}`;

      const res = await fetch(url);
      const data = await res.json();

      const ids = data.items.map(item => item.id.videoId).join(',');
      const detailRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet&id=${ids}&key=${API_KEY}`);
      const detailData = await detailRes.json();

      const results = detailData.items.filter(item => {
        const title = item.snippet.title.toLowerCase();
        if (blocked.some(term => term && title.includes(term))) return false;
        const duration = parseDuration(item.contentDetails.duration);
        if (hideShorts && duration < 60) return false;
        if (onlyEnglish && item.snippet.defaultAudioLanguage !== 'en') return false;
        if (onlyUS && item.snippet.defaultLanguage !== 'en' && item.snippet.regionRestriction?.allowed?.indexOf('US') === -1) return false;
        return true;
      });

      if (sortOrder === 'asc') {
        results.sort((a, b) => a.snippet.title.localeCompare(b.snippet.title));
      } else if (sortBy === 'date') {
        results.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
      }

      document.getElementById('results').innerHTML = results.map(v =>
        `<div class="video">
          <strong>${v.snippet.title}</strong><br />
          <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank">Watch</a>
        </div>`
      ).join('');
    }
  </script></body>
</html>

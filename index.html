<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Video Filter</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    input, select, button { margin: 5px; }
    #results { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>YouTube Video Filter</h1>  <input id="query" placeholder="Search term" />
  <input id="blockedTerms" placeholder="Blocked terms (comma-separated)" />
  <select id="duration">
    <option value="any">Any duration</option>
    <option value="short">Short (&lt; 4 min)</option>
    <option value="medium">Medium (4â€“20 min)</option>
    <option value="long">Long (&gt; 20 min)</option>
  </select>
  <input id="publishedAfter" type="date" />
  <label>
    <input type="checkbox" id="hideShorts" /> Hide Shorts
  </label>
  <button onclick="searchVideos()">Search</button>  <div id="results"></div>  <script>
    const API_KEY = 'AIzaSyCOpM3LTOwzxzi2rHyDeWx5GM-D3wV7CS4'; // Replace with your actual API key

    function getDateISOString(inputId) {
      const val = document.getElementById(inputId).value;
      return val ? new Date(val).toISOString() : null;
    }

    function saveSettings() {
      const keys = ['query', 'blockedTerms', 'duration', 'publishedAfter', 'hideShorts'];
      keys.forEach(key => {
        const el = document.getElementById(key);
        localStorage.setItem(key, el.type === 'checkbox' ? el.checked : el.value);
      });
    }

    function loadSettings() {
      ['query', 'blockedTerms', 'duration', 'publishedAfter'].forEach(id => {
        if (localStorage.getItem(id)) document.getElementById(id).value = localStorage.getItem(id);
      });
      document.getElementById('hideShorts').checked = localStorage.getItem('hideShorts') === 'true';
    }

    async function searchVideos() {
      document.getElementById('results').innerText = 'Loading results...';
      saveSettings();

      const query = document.getElementById('query').value;
      const blocked = document.getElementById('blockedTerms').value.split(',').map(t => t.trim()).filter(t => t);
      const duration = document.getElementById('duration').value;
      const publishedAfter = getDateISOString('publishedAfter');
      const hideShorts = document.getElementById('hideShorts').checked;

      const url = new URL('https://www.googleapis.com/youtube/v3/search');
      url.searchParams.set('part', 'snippet');
      url.searchParams.set('q', query);
      url.searchParams.set('type', 'video');
      url.searchParams.set('maxResults', '25');
      url.searchParams.set('videoDuration', duration);
      if (publishedAfter) url.searchParams.set('publishedAfter', publishedAfter);
      url.searchParams.set('key', API_KEY);

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`API Error ${response.status}`);
        const data = await response.json();

        const filtered = data.items.filter(item => {
          const title = item.snippet.title.toLowerCase();
          const description = item.snippet.description.toLowerCase();
          const isShort = title.includes('#shorts') || description.includes('#shorts');

          if (hideShorts && isShort) return false;
          return !blocked.some(term => {
            const regex = new RegExp(term, 'i');
            return regex.test(title) || regex.test(description);
          });
        });

        const output = filtered.map(item => {
          const { title, publishedAt, channelTitle, description } = item.snippet;
          const videoId = item.id.videoId;
          const url = `https://www.youtube.com/watch?v=${videoId}`;
          return `<div><b><a href="${url}" target="_blank">${title}</a></b><br>
                  Channel: ${channelTitle}<br>
                  Published: ${publishedAt}<br>
                  Description: ${description}</div><hr>`;
        }).join('');

        document.getElementById('results').innerHTML = output || 'No matching videos found.';
      } catch (err) {
        document.getElementById('results').innerText = `Error: ${err.message}`;
      }
    }

    loadSettings();
  </script></body>
</html>
